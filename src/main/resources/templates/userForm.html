<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/ui :: head('User Form â€¢ NMS Cinemas')}"></head>
<body>
<div th:replace="~{fragments/ui :: navbar('users')}"></div>
<main class="container">

  <h1 th:text="${isEdit} ? 'Edit User' : 'Create User'">Create User</h1>

  <p th:if="${successMessage}" class="alert success" th:text="${successMessage}"></p>
  <p th:if="${errorMessage}" class="alert error" th:text="${errorMessage}"></p>

  <form th:action="${isEdit} ? @{/users/{id}(id=${user.idusers})} : @{/users}"
        method="post"
        th:object="${user}">

    <!-- Username -->
    <div>
      <label for="username">Username *</label>
      <input id="username"
             type="text"
             th:field="*{username}"
             th:classappend="${#fields.hasErrors('username')} ? 'field-invalid' : ''"
             required
             maxlength="255"
             placeholder="e.g., john_doe"/>
      <div class="error" th:if="${#fields.hasErrors('username')}" th:errors="*{username}">Username error</div>
      <div class="help">Unique username for login.</div>
    </div>

    <!-- Email -->
    <div>
      <label for="email">Email *</label>
      <input id="email"
             type="email"
             th:field="*{email}"
             th:classappend="${#fields.hasErrors('email')} ? 'field-invalid' : ''"
             required
             maxlength="100"
             placeholder="user@example.com"/>
      <div class="error" th:if="${#fields.hasErrors('email')}" th:errors="*{email}">Email error</div>
      <div class="help">Must be a valid email address.</div>
    </div>

    <!-- Password -->
    <div>
      <label for="password">Password <span th:if="${isEdit}">(leave blank to keep current)</span></label>
      <input id="password"
             type="password"
             th:field="*{password}"
             th:classappend="${#fields.hasErrors('password')} ? 'field-invalid' : ''"
             th:required="${!isEdit}"
             maxlength="255"
             placeholder="Enter password"/>
      <div class="error" th:if="${#fields.hasErrors('password')}" th:errors="*{password}">Password error</div>
      <div class="help" th:if="${!isEdit}">Minimum 6 characters recommended.</div>
    </div>

    <!-- Role -->
    <div>
      <label for="role">Role *</label>
      <select id="role" th:field="*{role}" required>
        <option value="USER">USER</option>
        <option value="ADMIN">ADMIN</option>
      </select>
      <div class="help">USER = standard customer, ADMIN = full access</div>
    </div>

    <!-- Buttons -->
    <div class="actions">
      <button class="btn primary" type="submit" th:text="${isEdit} ? 'Save Changes' : 'Create User'">Create User</button>
      <a class="btn" th:href="@{/users}">Cancel</a>
    </div>
  </form>

</main>

<div th:replace="~{fragments/ui :: footer}"></div>

</body>
</html>